# ğŸ“ Google Colab ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆ - å°å­¦ç”Ÿãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚¹ã‚¯ãƒ¼ãƒ«AI
# UIå•é¡Œã‚’è§£æ±ºã—ãŸç¢ºå®Ÿå‹•ä½œç‰ˆ

print("ğŸš€ å°å­¦ç”Ÿå‘ã‘ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚¹ã‚¯ãƒ¼ãƒ«AIï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰")
print("=" * 50)

# ===== 1. è‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« =====
import subprocess
import sys

def install_packages():
    """å¿…è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è‡ªå‹•ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"""
    try:
        subprocess.check_call([sys.executable, "-m", "pip", "install", "openai", "-q"])
        print("âœ… OpenAIãƒ©ã‚¤ãƒ–ãƒ©ãƒª ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†")
    except:
        print("âš ï¸ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ã‚¹ã‚­ãƒƒãƒ—")

install_packages()

# ===== 2. ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¤ãƒ³ãƒãƒ¼ãƒˆ =====
try:
    from openai import OpenAI
    from google.colab import userdata
    print("âœ… ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿å®Œäº†")
except ImportError as e:
    print(f"âŒ ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼: {e}")

# ===== 3. ã‚·ãƒ³ãƒ—ãƒ«AIã‚¯ãƒ©ã‚¹ =====
class SimpleProgrammingAI:
    """ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚¹ã‚¯ãƒ¼ãƒ«AI"""
    
    def __init__(self):
        self.client = None
        
        # é¸æŠè‚¢ã®å®šç¾©
        self.grades = {
            "1": "å°å­¦æ ¡ä½å­¦å¹´ï¼ˆ6-8æ­³ï¼‰",
            "2": "å°å­¦æ ¡ä¸­å­¦å¹´ï¼ˆ9-10æ­³ï¼‰", 
            "3": "å°å­¦æ ¡é«˜å­¦å¹´ï¼ˆ11-12æ­³ï¼‰"
        }
        
        self.themes = {
            "1": "ScratchåŸºç¤",
            "2": "ã‚²ãƒ¼ãƒ ä½œã‚Š",
            "3": "ãƒ­ãƒœãƒƒãƒˆåˆ¶å¾¡",
            "4": "Webã‚µã‚¤ãƒˆä½œæˆ",
            "5": "ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³",
            "6": "éŸ³æ¥½ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°"
        }
        
        self.functions = {
            "1": "ğŸ“š ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ä½œæˆ",
            "2": "ğŸ’¡ æˆæ¥­ã‚¢ã‚¤ãƒ‡ã‚£ã‚¢ï¼ˆ5å€‹ï¼‰",
            "3": "ğŸš€ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆææ¡ˆï¼ˆ3å€‹ï¼‰"
        }

    def setup_api(self):
        """APIè¨­å®š"""
        try:
            api_key = userdata.get('OPENAI_API_KEY')
            self.client = OpenAI(api_key=api_key)
            
            # æ¥ç¶šãƒ†ã‚¹ãƒˆ
            self.client.chat.completions.create(
                model="gpt-3.5-turbo",
                messages=[{"role": "user", "content": "Hello"}],
                max_tokens=1
            )
            print("âœ… OpenAI APIæ¥ç¶šå®Œäº†")
            return True
        except Exception as e:
            print(f"âŒ APIè¨­å®šã‚¨ãƒ©ãƒ¼: {e}")
            return False

    def show_menu(self, title, options):
        """ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤º"""
        print(f"\nğŸ“‹ {title}")
        print("-" * 30)
        for key, value in options.items():
            print(f"{key}. {value}")
        print("-" * 30)

    def get_choice(self, options, message="é¸æŠã—ã¦ãã ã•ã„"):
        """é¸æŠå…¥åŠ›"""
        while True:
            choice = input(f"{message} (ç•ªå·å…¥åŠ›): ").strip()
            if choice in options:
                return choice
            print("âŒ ç„¡åŠ¹ãªé¸æŠã§ã™ã€‚ã‚‚ã†ä¸€åº¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚")

    def generate_content(self, prompt):
        """AIç”Ÿæˆ"""
        try:
            print("ğŸ¤– AIç”Ÿæˆä¸­... å°‘ã€…ãŠå¾…ã¡ãã ã•ã„")
            response = self.client.chat.completions.create(
                model="gpt-3.5-turbo",
                messages=[{"role": "user", "content": prompt}],
                temperature=0.7,
                max_tokens=1500
            )
            return response.choices[0].message.content
        except Exception as e:
            return f"âŒ ã‚¨ãƒ©ãƒ¼: {str(e)}"

    def create_curriculum(self, grade, theme):
        """ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ä½œæˆ"""
        prompt = f"""
{grade}å‘ã‘ã®{theme}ã®4é€±é–“ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

ä»¥ä¸‹ã®æ§‹æˆã§ä½œæˆï¼š
1. ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ æ¦‚è¦
2. å­¦ç¿’ç›®æ¨™ï¼ˆ3ã¤ï¼‰
3. é€±åˆ¥å­¦ç¿’å†…å®¹
   - ç¬¬1é€±ï¼šåŸºç¤å­¦ç¿’
   - ç¬¬2é€±ï¼šå¿œç”¨å­¦ç¿’  
   - ç¬¬3é€±ï¼šå®Ÿè·µå­¦ç¿’
   - ç¬¬4é€±ï¼šç™ºè¡¨ãƒ»ã¾ã¨ã‚
4. å„é€±ã®è©³ç´°ãªæ´»å‹•å†…å®¹
5. è©•ä¾¡æ–¹æ³•

å°å­¦ç”ŸãŒæ¥½ã—ãå­¦ã¹ã‚‹å†…å®¹ã§ã€å®Ÿéš›ã«æˆæ¥­ã§ä½¿ãˆã‚‹å½¢å¼ã§ä½œæˆã—ã¦ãã ã•ã„ã€‚
        """
        return self.generate_content(prompt)

    def create_ideas(self, grade, theme):
        """æˆæ¥­ã‚¢ã‚¤ãƒ‡ã‚£ã‚¢ä½œæˆ"""
        prompt = f"""
{grade}å‘ã‘ã®{theme}ã®æˆæ¥­ã‚¢ã‚¤ãƒ‡ã‚£ã‚¢ã‚’5ã¤ææ¡ˆã—ã¦ãã ã•ã„ã€‚

å„ã‚¢ã‚¤ãƒ‡ã‚£ã‚¢ã«ã¤ã„ã¦ä»¥ä¸‹ã‚’å«ã‚ã‚‹ï¼š
1. ã‚¢ã‚¤ãƒ‡ã‚£ã‚¢å
2. æˆæ¥­æ™‚é–“ï¼ˆ45åˆ†æƒ³å®šï¼‰
3. å­¦ç¿’ç›®æ¨™
4. å¿…è¦ãªæº–å‚™
5. æˆæ¥­ã®æµã‚Œï¼ˆå°å…¥ãƒ»å±•é–‹ãƒ»ã¾ã¨ã‚ï¼‰
6. å­ã©ã‚‚ãŸã¡ãŒæ¥½ã—ã‚ã‚‹ãƒã‚¤ãƒ³ãƒˆ

å‰µé€ çš„ã§å®Ÿè·µçš„ãªæˆæ¥­ã‚¢ã‚¤ãƒ‡ã‚£ã‚¢ã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚
        """
        return self.generate_content(prompt)

    def create_projects(self, grade, theme):
        """ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆææ¡ˆä½œæˆ"""
        prompt = f"""
{grade}å‘ã‘ã®{theme}ã‚’ä½¿ã£ãŸå®Ÿè·µãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’3ã¤ææ¡ˆã—ã¦ãã ã•ã„ã€‚

å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¤ã„ã¦ä»¥ä¸‹ã‚’å«ã‚ã‚‹ï¼š
1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå
2. å®Œæˆã¾ã§ã®æ™‚é–“
3. å­¦ç¿’åŠ¹æœ
4. å¿…è¦ãªãƒ„ãƒ¼ãƒ«ãƒ»ææ–™
5. åˆ¶ä½œæ‰‹é †ï¼ˆã‚¹ãƒ†ãƒƒãƒ—åˆ¥ï¼‰
6. ç™ºè¡¨ãƒ»å…±æœ‰æ–¹æ³•
7. é›£æ˜“åº¦ãƒ¬ãƒ™ãƒ«

å­ã©ã‚‚ãŸã¡ãŒé”æˆæ„Ÿã‚’å¾—ã‚‰ã‚Œã‚‹é­…åŠ›çš„ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚
        """
        return self.generate_content(prompt)

    def show_result(self, title, content):
        """çµæœè¡¨ç¤º"""
        print(f"\nğŸ‰ {title} ä½œæˆå®Œäº†ï¼")
        print("=" * 60)
        print(content)
        print("=" * 60)
        print("âœ… ä¸Šè¨˜ã®å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã”åˆ©ç”¨ãã ã•ã„")

    def start(self):
        """ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—"""
        print("\nğŸ“ å°å­¦ç”Ÿå‘ã‘ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚¹ã‚¯ãƒ¼ãƒ«AI")
        print("=" * 40)
        
        if not self.setup_api():
            print("\nğŸ”‘ APIã‚­ãƒ¼è¨­å®šæ–¹æ³•:")
            print("1. å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ğŸ”‘ï¼ˆSecretsï¼‰ã‚’ã‚¯ãƒªãƒƒã‚¯")
            print("2. 'New secret'ã‚’ã‚¯ãƒªãƒƒã‚¯")
            print("3. Name: OPENAI_API_KEY")
            print("4. Value: ã‚ãªãŸã®OpenAI APIã‚­ãƒ¼")
            print("5. 'Notebook access'ã‚’ONã«ã™ã‚‹")
            print("6. ã“ã®ã‚»ãƒ«ã‚’å†å®Ÿè¡Œ")
            return

        while True:
            # å­¦å¹´é¸æŠ
            self.show_menu("å¯¾è±¡å­¦å¹´ã‚’é¸æŠ", self.grades)
            grade_choice = self.get_choice(self.grades, "å­¦å¹´ã‚’é¸æŠ")
            selected_grade = self.grades[grade_choice]
            
            # ãƒ†ãƒ¼ãƒé¸æŠ
            self.show_menu("å­¦ç¿’ãƒ†ãƒ¼ãƒã‚’é¸æŠ", self.themes)
            theme_choice = self.get_choice(self.themes, "ãƒ†ãƒ¼ãƒã‚’é¸æŠ")
            selected_theme = self.themes[theme_choice]
            
            # æ©Ÿèƒ½é¸æŠ
            self.show_menu("ä½œæˆã™ã‚‹æ•™æã‚’é¸æŠ", self.functions)
            func_choice = self.get_choice(self.functions, "æ©Ÿèƒ½ã‚’é¸æŠ")
            
            print(f"\nğŸ“ è¨­å®šç¢ºèª:")
            print(f"å­¦å¹´: {selected_grade}")
            print(f"ãƒ†ãƒ¼ãƒ: {selected_theme}")
            print(f"æ©Ÿèƒ½: {self.functions[func_choice]}")
            
            # AIç”Ÿæˆå®Ÿè¡Œ
            if func_choice == "1":
                result = self.create_curriculum(selected_grade, selected_theme)
                self.show_result("ğŸ“š ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ", result)
            elif func_choice == "2":
                result = self.create_ideas(selected_grade, selected_theme)
                self.show_result("ğŸ’¡ æˆæ¥­ã‚¢ã‚¤ãƒ‡ã‚£ã‚¢", result)
            elif func_choice == "3":
                result = self.create_projects(selected_grade, selected_theme)
                self.show_result("ğŸš€ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆææ¡ˆ", result)
            
            # ç¶™ç¶šç¢ºèª
            print("\n" + "="*40)
            continue_choice = input("åˆ¥ã®æ•™æã‚’ä½œæˆã—ã¾ã™ã‹ï¼Ÿ (y/n): ").strip().lower()
            if continue_choice != 'y':
                print("ğŸ‘‹ ã”åˆ©ç”¨ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼")
                break

# ===== 4. ç°¡å˜èµ·å‹•é–¢æ•° =====
def start_ai():
    """AIèµ·å‹•ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰"""
    app = SimpleProgrammingAI()
    app.start()

def quick_demo():
    """ã‚¯ã‚¤ãƒƒã‚¯ãƒ‡ãƒ¢"""
    print("ğŸ¯ ã‚¯ã‚¤ãƒƒã‚¯ãƒ‡ãƒ¢")
    print("=" * 30)
    print("ã“ã®ãƒ„ãƒ¼ãƒ«ã§ã§ãã‚‹ã“ã¨:")
    print("ğŸ“š 4é€±é–“ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ è‡ªå‹•ç”Ÿæˆ")
    print("ğŸ’¡ 5ã¤ã®æˆæ¥­ã‚¢ã‚¤ãƒ‡ã‚£ã‚¢ææ¡ˆ") 
    print("ğŸš€ 3ã¤ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆææ¡ˆ")
    print()
    print("å¯¾å¿œå­¦å¹´: ä½å­¦å¹´ã€œé«˜å­¦å¹´")
    print("ãƒ†ãƒ¼ãƒ: Scratchã€ã‚²ãƒ¼ãƒ ã€ãƒ­ãƒœãƒƒãƒˆç­‰6ç¨®é¡")
    print()
    print("ğŸš€ start_ai() ã§é–‹å§‹ï¼")

def help_setup():
    """ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ˜ãƒ«ãƒ—"""
    print("ğŸ”§ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ–¹æ³•")
    print("=" * 30)
    print("1. OpenAI APIã‚­ãƒ¼ã‚’å–å¾—")
    print("   - https://platform.openai.com/")
    print("   - ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³")
    print("   - API Keys ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚­ãƒ¼ç”Ÿæˆ")
    print()
    print("2. Google Colab Secretsã«è¨­å®š")
    print("   - å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ğŸ”‘ã‚¯ãƒªãƒƒã‚¯")
    print("   - 'New secret'ã‚¯ãƒªãƒƒã‚¯")
    print("   - Name: OPENAI_API_KEY")  
    print("   - Value: ã‚ãªãŸã®APIã‚­ãƒ¼")
    print("   - 'Notebook access' ON")
    print()
    print("3. start_ai() ã§é–‹å§‹")

# ===== 5. ä½¿ç”¨æ–¹æ³•æ¡ˆå†… =====
print("\nğŸ¯ ä½¿ç”¨æ–¹æ³•ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰")
print("=" * 25)
print("quick_demo()   # ãƒ‡ãƒ¢ãƒ»æ©Ÿèƒ½ç´¹ä»‹")
print("help_setup()   # ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ–¹æ³•")
print("start_ai()     # AIèµ·å‹•")
print("=" * 25)
print("\nğŸ’¡ æ”¹å–„ç‚¹:")
print("âœ… UIãƒœã‚¿ãƒ³ â†’ ã‚·ãƒ³ãƒ—ãƒ«ãªæ•°å­—å…¥åŠ›")
print("âœ… è¤‡é›‘ãªè¡¨ç¤º â†’ åŸºæœ¬çš„ãªprintå‡ºåŠ›")
print("âœ… ipywidgetsä¸è¦ â†’ æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã¿")
print("âœ… ç¢ºå®Ÿå‹•ä½œ â†’ ã‚¨ãƒ©ãƒ¼å¯¾ç­–å¼·åŒ–")
print("\nğŸš€ ä»Šã™ã start_ai() ã§é–‹å§‹ã—ã¾ã—ã‚‡ã†ï¼")
